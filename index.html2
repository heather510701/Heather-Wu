<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é•·è€…é‹å‹•å¤§å¯Œç¿</title>
    
    <!-- å¼•å…¥ Tailwind CSS (æ¨£å¼) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- å¼•å…¥ Babel (ç”¨ä¾†è§£æ JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            touch-action: manipulation; /* å„ªåŒ–è§¸æ§æ“ä½œ */
            overscroll-behavior: none; /* é˜²æ­¢æ‹‰å‹•é é¢ */
        }
        /* éš±è—æ»¾å‹•æ¢ä½†ä¿ç•™åŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- å…§å»ºåœ–ç¤ºå…ƒä»¶ (å–ä»£ lucide-react ä¾è³´) ---
        const IconBase = ({ children, className, ...props }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width="24" height="24" 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className} 
                {...props}
            >
                {children}
            </svg>
        );

        const Star = (props) => <IconBase {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" /></IconBase>;
        const Activity = (props) => <IconBase {...props}><path d="M22 12h-4l-3 9L9 3l-3 9H2" /></IconBase>;
        const Brain = (props) => <IconBase {...props}><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></IconBase>;
        const Users = (props) => <IconBase {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></IconBase>;
        const Trophy = (props) => <IconBase {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></IconBase>;
        const Heart = (props) => <IconBase {...props}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></IconBase>;
        const Play = (props) => <IconBase {...props}><polygon points="5 3 19 12 5 21 5 3" /></IconBase>;
        const CheckCircle = (props) => <IconBase {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></IconBase>;
        const Video = (props) => <IconBase {...props}><path d="m22 8-6 4 6 4V8Z"/><rect x="2" y="6" width="14" height="12" rx="2" ry="2"/></IconBase>;
        const Minimize2 = (props) => <IconBase {...props}><polyline points="4 14 10 14 10 20"/><polyline points="20 10 14 10 14 4"/></IconBase>;
        const Maximize2 = (props) => <IconBase {...props}><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" x2="14" y1="3" y2="10"/><line x1="3" x2="10" y1="21" y2="14"/></IconBase>;


        // --- éŠæˆ²è³‡æ–™è¨­å®š ---
        const TILE_TYPES = {
            START: { label: 'èµ·é»', color: 'bg-green-600', icon: <Star className="w-8 h-8 md:w-10 md:h-10 text-white" /> },
            EXERCISE: { label: 'å‹•å‹•æ‰‹è…³', color: 'bg-orange-500', icon: <Activity className="w-8 h-8 md:w-10 md:h-10 text-white" /> },
            QUIZ: { label: 'å¥åº·è…¦åŠ›', color: 'bg-blue-500', icon: <Brain className="w-8 h-8 md:w-10 md:h-10 text-white" /> },
            SOCIAL: { label: 'æ­¡æ¨‚äº’å‹•', color: 'bg-pink-500', icon: <Users className="w-8 h-8 md:w-10 md:h-10 text-white" /> },
            CHANCE: { label: 'æ©Ÿæœƒå‘½é‹', color: 'bg-purple-500', icon: <Trophy className="w-8 h-8 md:w-10 md:h-10 text-white" /> },
            REST: { label: 'å–æ°´ä¼‘æ¯', color: 'bg-teal-500', icon: <Heart className="w-8 h-8 md:w-10 md:h-10 text-white" /> },
        };

        const TASK_DATABASE = {
            EXERCISE: [
                { text: "é›™æ‰‹å‘ä¸Šèˆ‰é«˜ï¼Œæ·±å‘¼å¸ä¸‰æ¬¡", points: 20 },
                { text: "åŸåœ°è¸æ­¥ 30 ç§’", points: 30 },
                { text: "é›™æ‰‹å‘å‰ä¼¸ç›´ï¼Œæ‰‹æŒé–‹åˆ 10 æ¬¡", points: 20 },
                { text: "è½‰å‹•è‚©è†€ï¼Œå‘å‰ 5 åœˆï¼Œå‘å¾Œ 5 åœˆ", points: 20 },
                { text: "åå§¿æŠ¬è†è“‹ï¼Œå·¦å³å„ 5 æ¬¡", points: 30 },
                { text: "é›™æ‰‹æ’è…°ï¼Œèº«é«”å·¦å³è¼•è¼•è½‰å‹•", points: 20 },
                { text: "æ¨¡ä»¿ã€Œæ¸¸è›™å¼ã€çš„å‹•ä½œ 5 æ¬¡", points: 25 },
                { text: "é›™æ‰‹æ¯”ã€Œè®šã€ï¼Œå‘å‰ä¼¸å±•æ‰‹è‡‚", points: 15 },
            ],
            QUIZ: [
                { text: "è«‹å•ä¸€å¤©å»ºè­°å–å¤šå°‘æ°´ï¼Ÿ (1) 500cc (2) 2000cc", answer: "ç­”æ¡ˆï¼š(2) 2000cc", points: 20 },
                { text: "é‹å‹•å‰è¦åšä»€éº¼äº‹å¯ä»¥é é˜²å—å‚·ï¼Ÿ", answer: "ç­”æ¡ˆï¼šæš–èº«é‹å‹•", points: 20 },
                { text: "é é˜²è·Œå€’ï¼Œå®¶è£¡åœ°æ¿æ‡‰è©²ä¿æŒï¼Ÿ(1) æ¿•æ»‘ (2) ä¹¾ç‡¥", answer: "ç­”æ¡ˆï¼š(2) ä¹¾ç‡¥", points: 15 },
                { text: "å¿ƒæƒ…ä¸å¥½æ™‚ï¼Œæ‰¾æœ‹å‹èŠå¤©æœ‰å¹«åŠ©å—ï¼Ÿ", answer: "ç­”æ¡ˆï¼šéå¸¸æœ‰å¹«åŠ©ï¼", points: 15 },
                { text: "é€™å¥æˆèªæ¥é¾ï¼šã€Œèº«é«”...ã€", answer: "ç­”æ¡ˆï¼šèº«é«”å¥åº·", points: 30 },
            ],
            SOCIAL: [
                { text: "å…¨éšŠä¸€èµ·å°éš”å£éšŠä¼æ¯”å€‹ã€Œæ„›å¿ƒã€æ‰‹å‹¢", points: 30 },
                { text: "è«‹å…¨éšŠä¸€èµ·å¤§ç¬‘ä¸‰è²ã€Œå“ˆï¼å“ˆï¼å“ˆï¼ã€", points: 25 },
                { text: "å¹«ä½ å³é‚Šçš„å¤¥ä¼´æ¥æ¥èƒŒ", points: 30 },
                { text: "å…¨éšŠä¸€èµ·å¤§å–Šï¼šã€Œæˆ‘å€‘æœ€å¥åº·ï¼ã€", points: 20 },
                { text: "èˆ‡å¦ä¸€éšŠçš„ä¸€ä½ä»£è¡¨æ¡æ‰‹æˆ–æ“ŠæŒ", points: 25 },
                { text: "å…¨éšŠä¸€èµ·å”±å…©å¥å¤§å®¶éƒ½æœƒçš„æ­Œ (å¦‚: ç”œèœœèœœ)", points: 50 },
            ],
            CHANCE: [
                { text: "æ­å–œï¼ç›´æ¥ç²å¾—åŠ åˆ†ï¼", points: 50 },
                { text: "å¤ªæ£’äº†ï¼å…¨é«”éšŠå“¡èµ·ç«‹æ¥å—æŒè²", points: 30 },
                { text: "ä¼‘æ¯æ˜¯ç‚ºäº†èµ°æ›´é•·çš„è·¯ï¼Œæš«åœä¸€å›åˆ (ä½†ä¹ŸåŠ  10 åˆ†)", points: 10 },
                { text: "éª°å­é»æ•¸åŠ å€é€åˆ†ï¼", points: 40 },
            ]
        };

        const generateBoard = () => {
            const board = [];
            const types = ['EXERCISE', 'QUIZ', 'SOCIAL', 'EXERCISE', 'CHANCE', 'EXERCISE', 'SOCIAL', 'QUIZ', 'EXERCISE', 'REST', 'SOCIAL', 'EXERCISE', 'QUIZ', 'CHANCE', 'SOCIAL', 'EXERCISE', 'QUIZ', 'SOCIAL', 'EXERCISE'];
            
            board.push({ id: 0, type: 'START', ...TILE_TYPES.START });
            types.forEach((type, index) => {
                board.push({ id: index + 1, type, ...TILE_TYPES[type] });
            });
            return board;
        };

        const BOARD_DATA = generateBoard();

        const getGridPosition = (index) => {
            if (index >= 0 && index <= 5) return { row: 6, col: index + 1 };
            if (index >= 6 && index <= 10) return { row: 6 - (index - 5), col: 6 };
            if (index >= 11 && index <= 15) return { row: 1, col: 6 - (index - 10) };
            if (index >= 16 && index <= 19) return { row: 1 + (index - 15), col: 1 };
            return { row: 1, col: 1 };
        };

        const TEAM_COLORS = [
            { name: 'ç´…éšŠ', bg: 'bg-red-600', text: 'text-red-700', border: 'border-red-600', ring: 'ring-red-300', placeholder: 'ä¾‹å¦‚: ç´…éšŠ' },
            { name: 'è—éšŠ', bg: 'bg-blue-700', text: 'text-blue-700', border: 'border-blue-700', ring: 'ring-blue-300', placeholder: 'ä¾‹å¦‚: è—éšŠ' },
            { name: 'é»ƒéšŠ', bg: 'bg-yellow-500', text: 'text-yellow-700', border: 'border-yellow-500', ring: 'ring-yellow-300', placeholder: 'ä¾‹å¦‚: é»ƒéšŠ' },
            { name: 'ç¶ éšŠ', bg: 'bg-green-600', text: 'text-green-700', border: 'border-green-600', ring: 'ring-green-300', placeholder: 'ä¾‹å¦‚: ç¶ éšŠ' },
        ];

        // --- ä¸»æ‡‰ç”¨ç¨‹å¼ ---
        function ElderMonopoly() {
            const [gameState, setGameState] = useState('SETUP');
            const [teams, setTeams] = useState([]);
            const [currentTeamIndex, setCurrentTeamIndex] = useState(0);
            const [diceNumber, setDiceNumber] = useState(1);
            const [isRolling, setIsRolling] = useState(false);
            const [currentTask, setCurrentTask] = useState(null);
            const [showConfetti, setShowConfetti] = useState(false);
            const [setupTeamCount, setSetupTeamCount] = useState(2);
            const [customTeamNames, setCustomTeamNames] = useState(TEAM_COLORS.map(t => t.name));
            const [isVideoMinimized, setIsVideoMinimized] = useState(false);

            const playSound = (type) => {
                try {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    if (!AudioContext) return;
                    
                    const ctx = new AudioContext();
                    const osc = ctx.createOscillator();
                    const gainNode = ctx.createGain();

                    osc.connect(gainNode);
                    gainNode.connect(ctx.destination);

                    const now = ctx.currentTime;

                    if (type === 'success' || type === 'levelup') {
                        osc.type = 'triangle'; 
                        gainNode.gain.setValueAtTime(0.3, now);
                        osc.frequency.setValueAtTime(523.25, now);       // Do
                        osc.frequency.setValueAtTime(659.25, now + 0.1); // Mi
                        osc.frequency.setValueAtTime(783.99, now + 0.2); // Sol
                        osc.frequency.setValueAtTime(1046.50, now + 0.3);// High Do
                        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.8);
                        osc.start(now);
                        osc.stop(now + 0.8);
                    } else if (type === 'tick') {
                        osc.type = 'square';
                        osc.frequency.setValueAtTime(600, now);
                        osc.frequency.exponentialRampToValueAtTime(200, now + 0.05);
                        gainNode.gain.setValueAtTime(0.1, now);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.05);
                        osc.start(now);
                        osc.stop(now + 0.05);
                    }
                } catch (e) {
                    console.error("Audio play failed", e);
                }
            };

            const handleTeamNameChange = (index, value) => {
                const newNames = [...customTeamNames];
                newNames[index] = value;
                setCustomTeamNames(newNames);
            };

            const startGame = () => {
                const newTeams = Array.from({ length: setupTeamCount }, (_, i) => ({
                    id: i,
                    name: customTeamNames[i] || TEAM_COLORS[i].name, 
                    color: TEAM_COLORS[i],
                    position: 0,
                    score: 0,
                    laps: 0 
                }));
                setTeams(newTeams);
                setGameState('PLAYING');
            };

            const rollDice = () => {
                if (isRolling) return;
                setIsRolling(true);
                let counter = 0;
                const interval = setInterval(() => {
                    playSound('tick');
                    setDiceNumber(Math.floor(Math.random() * 6) + 1);
                    counter++;
                    if (counter > 15) {
                        clearInterval(interval);
                        const finalDice = Math.floor(Math.random() * 6) + 1;
                        setDiceNumber(finalDice);
                        setIsRolling(false);
                        movePlayer(finalDice);
                    }
                }, 100);
            };

            const movePlayer = (steps) => {
                setTimeout(() => {
                    setTeams(prevTeams => {
                        const newTeams = [...prevTeams];
                        const team = newTeams[currentTeamIndex];
                        let newPos = team.position + steps;
                        
                        if (newPos >= BOARD_DATA.length) {
                            newPos = newPos % BOARD_DATA.length;
                            team.score += 50; 
                            team.laps += 1;
                            playSound('levelup');
                        }
                        
                        team.position = newPos;
                        triggerTileEvent(BOARD_DATA[newPos], team);
                        return newTeams;
                    });
                }, 800);
            };

            const triggerTileEvent = (tile, team) => {
                setTimeout(() => {
                    if (tile.type === 'START') {
                        nextTurn();
                    } else if (tile.type === 'REST') {
                        setCurrentTask({
                            type: 'REST',
                            title: 'ä¼‘æ¯ç«™',
                            content: 'å¤§å®¶å–å£æ°´ï¼Œæ·±å‘¼å¸ï¼Œä¼‘æ¯ä¸€ä¸‹ï¼',
                            points: 10,
                            teamName: team.name
                        });
                        setGameState('MODAL');
                    } else {
                        const categoryTasks = TASK_DATABASE[tile.type] || TASK_DATABASE.EXERCISE;
                        const randomTask = categoryTasks[Math.floor(Math.random() * categoryTasks.length)];
                        
                        setCurrentTask({
                            type: tile.type,
                            title: TILE_TYPES[tile.type].label,
                            content: randomTask.text,
                            answer: randomTask.answer,
                            points: randomTask.points,
                            teamName: team.name,
                            teamColor: team.color
                        });
                        setGameState('MODAL');
                    }
                }, 500);
            };

            const completeTask = (success) => {
                if (success) {
                    setTeams(prev => {
                        const newTeams = [...prev];
                        newTeams[currentTeamIndex].score += currentTask.points;
                        return newTeams;
                    });
                    playSound('success');
                    setShowConfetti(true);
                    setTimeout(() => setShowConfetti(false), 2000);
                }
                setGameState('PLAYING');
                setCurrentTask(null);
                nextTurn();
            };

            const nextTurn = () => {
                setCurrentTeamIndex((prev) => (prev + 1) % teams.length);
            };

            const endGame = () => {
                setGameState('FINISHED');
                setShowConfetti(true);
            };

            const resetGame = () => {
                setGameState('SETUP');
                setTeams([]);
                setCurrentTeamIndex(0);
                setShowConfetti(false);
            };

            const renderContent = () => {
                if (gameState === 'SETUP') {
                    return (
                        <div className="min-h-screen bg-yellow-50 flex flex-col items-center justify-center p-4 font-sans w-full">
                            <div className="bg-white p-8 md:p-12 rounded-[3rem] shadow-2xl max-w-3xl w-full text-center border-8 border-orange-400">
                                <h1 className="text-6xl md:text-7xl font-black text-orange-600 mb-6 tracking-wider drop-shadow-sm">é•·è€…é‹å‹•å¤§å¯Œç¿</h1>
                                
                                <div className="mb-8">
                                    <h2 className="text-3xl md:text-4xl text-gray-700 font-bold mb-6">1. è«‹å•ä»Šå¤©æœ‰å¹¾çµ„åƒåŠ ï¼Ÿ</h2>
                                    <div className="flex justify-center gap-6">
                                        {[2, 3, 4].map(num => (
                                            <button
                                                key={num}
                                                onClick={() => setSetupTeamCount(num)}
                                                className={`w-20 h-20 md:w-24 md:h-24 rounded-full text-4xl font-black transition-all transform hover:scale-110 ${
                                                    setupTeamCount === num 
                                                    ? 'bg-orange-500 text-white shadow-xl ring-8 ring-orange-200' 
                                                    : 'bg-gray-200 text-gray-500 hover:bg-gray-300'
                                                }`}
                                            >
                                                {num}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                <div className="mb-10 bg-orange-50 p-6 rounded-3xl border-2 border-orange-100">
                                    <h2 className="text-2xl md:text-3xl text-gray-700 font-bold mb-4">2. å¹«å„çµ„å–å€‹å¥½è½çš„åå­—ï¼š</h2>
                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                        {Array.from({ length: setupTeamCount }).map((_, index) => (
                                            <div key={index} className="flex items-center gap-2">
                                                <div className={`w-12 h-12 rounded-full border-4 border-white shadow-md flex items-center justify-center text-white font-bold text-xl shrink-0 ${TEAM_COLORS[index].bg}`}>
                                                    {index + 1}
                                                </div>
                                                <input 
                                                    type="text" 
                                                    value={customTeamNames[index]}
                                                    onChange={(e) => handleTeamNameChange(index, e.target.value)}
                                                    placeholder={TEAM_COLORS[index].placeholder}
                                                    className={`w-full text-2xl font-bold text-gray-700 p-3 rounded-xl border-4 outline-none focus:ring-4 transition-all ${TEAM_COLORS[index].border} focus:${TEAM_COLORS[index].ring}`}
                                                />
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <button 
                                    onClick={startGame}
                                    className="w-full bg-green-600 hover:bg-green-700 text-white text-4xl font-black py-8 px-8 rounded-3xl shadow-[0_8px_0_rgb(21,128,61)] active:shadow-none active:translate-y-2 transition-all flex items-center justify-center gap-6"
                                >
                                    <Play className="w-12 h-12 fill-current" />
                                    é–‹å§‹éŠæˆ²
                                </button>
                            </div>
                        </div>
                    );
                }

                if (gameState === 'FINISHED') {
                    const sortedTeams = [...teams].sort((a, b) => b.score - a.score);
                    return (
                        <div className="min-h-screen bg-yellow-100 flex flex-col items-center justify-center p-4 font-sans w-full">
                            <div className="bg-white p-8 rounded-3xl shadow-2xl max-w-4xl w-full text-center">
                                <h2 className="text-5xl font-black text-gray-800 mb-10">ğŸ† æ’è¡Œæ¦œ ğŸ†</h2>
                                <div className="space-y-6 mb-12">
                                    {sortedTeams.map((team, index) => (
                                        <div key={team.id} className={`flex items-center p-6 rounded-2xl border-4 ${index === 0 ? 'bg-yellow-50 border-yellow-400 scale-105 shadow-xl' : 'bg-white border-gray-200'}`}>
                                            <div className={`w-20 h-20 rounded-full flex items-center justify-center text-4xl font-black text-white mr-6 ${index === 0 ? 'bg-yellow-400' : 'bg-gray-400'}`}>
                                                {index + 1}
                                            </div>
                                            <div className="flex-1 text-left">
                                                <div className={`text-4xl font-black ${team.color.text}`}>{team.name}</div>
                                            </div>
                                            <div className="text-6xl font-black text-gray-800">{team.score} <span className="text-3xl font-bold text-gray-500">åˆ†</span></div>
                                        </div>
                                    ))}
                                </div>
                                <button 
                                    onClick={resetGame}
                                    className="bg-blue-600 text-white text-3xl font-bold py-6 px-16 rounded-full hover:bg-blue-700 shadow-xl"
                                >
                                    å†ç©ä¸€æ¬¡
                                </button>
                            </div>
                        </div>
                    );
                }

                const currentTeam = teams[currentTeamIndex];

                return (
                    <div className="h-screen w-screen bg-green-50 flex flex-col overflow-hidden font-sans select-none">
                        <header className="bg-white shadow-md p-2 flex justify-between items-center z-20 h-24 shrink-0">
                            <div className="flex items-center gap-4 pl-4">
                                <Activity className="text-orange-600 w-12 h-12" />
                                <h1 className="text-4xl font-black text-gray-800 tracking-wide hidden md:block">é•·è€…é‹å‹•å¤§å¯Œç¿</h1>
                            </div>
                            <div className="flex gap-6 pr-4 items-center">
                                {teams.map((team) => (
                                    <div key={team.id} className={`hidden md:flex flex-col items-center px-6 py-2 rounded-2xl border-4 ${team.color.bg} border-white shadow-md min-w-[140px]`}>
                                        <span className="text-2xl text-white font-bold mb-1">{team.name}</span>
                                        <span className="text-5xl font-black text-white leading-none drop-shadow-md">{team.score}</span>
                                    </div>
                                ))}
                                <button onClick={endGame} className="ml-2 px-8 py-4 bg-gray-200 rounded-full text-2xl text-gray-700 font-black hover:bg-gray-300 shadow-sm border-4 border-gray-300 transition-transform active:scale-95">
                                    çµæŸ
                                </button>
                            </div>
                        </header>
                
                        <main className="flex-1 relative flex items-center justify-center bg-green-100/50 p-2 md:p-4 overflow-hidden">
                            <div className="relative aspect-square h-full max-h-[calc(100vh-5rem)] w-auto grid grid-cols-6 grid-rows-6 gap-2 md:gap-3 p-3 bg-white rounded-[2rem] shadow-2xl border-8 border-green-200">
                                
                                <div className="col-start-2 col-span-4 row-start-2 row-span-4 bg-yellow-50/50 rounded-3xl flex flex-col items-center justify-center z-10 relative">
                                    <div className="flex flex-col items-center mb-3 md:mb-6 animate-in fade-in zoom-in duration-500">
                                        <div className="text-lg md:text-2xl font-bold text-gray-500 mb-1">ç¾åœ¨è¼ªåˆ°</div>
                                        <div className={`px-8 py-3 rounded-full text-4xl md:text-6xl font-black text-white shadow-lg tracking-widest ${currentTeam.color.bg} border-4 border-white`}>
                                            {currentTeam.name}
                                        </div>
                                    </div>
                    
                                    <button 
                                        onClick={rollDice}
                                        disabled={isRolling}
                                        className={`
                                            relative group w-36 h-36 md:w-52 md:h-52 flex items-center justify-center rounded-[2rem] shadow-[0_12px_24px_rgba(0,0,0,0.15)] transition-all duration-200
                                            ${isRolling ? 'bg-gray-100 cursor-not-allowed scale-95' : 'bg-white hover:scale-105 cursor-pointer hover:shadow-[0_16px_32px_rgba(0,0,0,0.2)]'}
                                            border-4 md:border-8 border-orange-100
                                        `}
                                    >
                                        <div className={`
                                            w-24 h-24 md:w-36 md:h-36 bg-white border-[4px] md:border-[6px] border-gray-800 rounded-2xl flex items-center justify-center shadow-inner
                                            ${isRolling ? 'animate-spin' : ''}
                                        `}>
                                            <span className={`text-6xl md:text-8xl font-black ${isRolling ? 'text-gray-300 blur-sm' : 'text-gray-800'}`}>
                                                {diceNumber}
                                            </span>
                                        </div>
                                        {!isRolling && (
                                            <div className="absolute -bottom-4 md:-bottom-6 bg-orange-500 text-white px-4 py-1.5 rounded-full text-base md:text-xl font-bold shadow-lg animate-bounce whitespace-nowrap">
                                                é»æˆ‘æ“²éª°å­
                                            </div>
                                        )}
                                    </button>
                                </div>
                
                                {BOARD_DATA.map((tile, index) => {
                                    const pos = getGridPosition(index);
                                    const teamsHere = teams.filter(t => t.position === index);
                                    
                                    return (
                                        <div 
                                            key={tile.id} 
                                            style={{ gridRow: pos.row, gridColumn: pos.col }}
                                            className={`
                                                relative rounded-xl md:rounded-2xl border-b-4 border-r-4 shadow-md flex flex-col items-center justify-center text-center transition-all
                                                ${tile.color} border-black/20
                                            `}
                                        >
                                            <div className="flex flex-col items-center justify-center h-full w-full p-1">
                                                <div className="mb-1 drop-shadow-md transform scale-90 md:scale-110">
                                                    {tile.icon}
                                                </div>
                                                <div className="text-white font-black text-base md:text-2xl lg:text-3xl leading-none drop-shadow-md tracking-wide">
                                                    {tile.label}
                                                </div>
                                            </div>
                                            <div className="absolute top-1 left-2 text-white/40 font-black text-xs md:text-lg">
                                                {index + 1}
                                            </div>
                                            {teamsHere.length > 0 && (
                                                <div className="absolute inset-0 flex items-center justify-center pointer-events-none z-20">
                                                    <div className="flex -space-x-4 bg-white/30 p-2 rounded-full backdrop-blur-sm shadow-xl border-2 border-white/50">
                                                        {teamsHere.map(t => (
                                                            <div key={t.id} className={`w-10 h-10 md:w-14 md:h-14 rounded-full border-4 border-white shadow-2xl flex items-center justify-center text-lg md:text-2xl font-black text-white ${t.color.bg}`}>
                                                                {t.name[0]}
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        </main>
                
                        {gameState === 'MODAL' && currentTask && (
                            <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 backdrop-blur-md animate-in fade-in duration-300">
                                <div className="bg-white rounded-[2.5rem] shadow-2xl max-w-4xl w-full h-auto max-h-[90vh] flex flex-col overflow-hidden border-8 border-white">
                                    <div className={`${currentTask.teamColor ? currentTask.teamColor.bg : 'bg-gray-600'} p-8 text-white text-center shrink-0 shadow-md z-10`}>
                                        <div className="text-3xl font-bold opacity-90 mb-2">{currentTask.teamName}</div>
                                        <div className="text-6xl font-black tracking-widest drop-shadow-lg">{currentTask.title}</div>
                                    </div>
                                    <div className="p-10 flex-1 flex flex-col items-center justify-center text-center overflow-y-auto bg-yellow-50">
                                        <div className="w-full bg-white p-8 rounded-3xl shadow-sm border-4 border-yellow-200 mb-8">
                                            <p className="text-5xl md:text-6xl font-black text-gray-800 leading-tight">
                                                {currentTask.content}
                                            </p>
                                            {currentTask.answer && (
                                                <div className="mt-8 pt-8 border-t-4 border-dashed border-gray-200">
                                                    <details className="group">
                                                        <summary className="cursor-pointer text-2xl text-blue-500 font-bold list-none p-4 hover:bg-blue-50 rounded-xl transition-colors">
                                                            é»é€™è£¡çœ‹ç­”æ¡ˆ
                                                        </summary>
                                                        <p className="mt-4 text-4xl font-bold text-green-600 bg-green-50 p-4 rounded-xl">{currentTask.answer}</p>
                                                    </details>
                                                </div>
                                            )}
                                        </div>
                                        <div className="text-4xl font-black text-orange-500 bg-white px-8 py-2 rounded-full shadow-sm border-2 border-orange-100">
                                            çå‹µï¼š{currentTask.points} åˆ†
                                        </div>
                                    </div>
                                    <div className="p-6 bg-white border-t flex gap-4 shrink-0">
                                        {currentTask.type === 'REST' ? (
                                            <button onClick={() => completeTask(true)} className="flex-1 bg-green-500 text-white text-3xl font-bold py-6 rounded-2xl shadow-lg active:scale-95 transition-transform">
                                                ä¼‘æ¯å¥½äº† (é ˜å–åˆ†æ•¸)
                                            </button>
                                        ) : (
                                            <>
                                                <button onClick={() => completeTask(false)} className="flex-1 bg-gray-400 text-white text-3xl font-bold py-6 rounded-2xl shadow active:scale-95 transition-transform">
                                                    æ”¾æ£„ / å¤±æ•—
                                                </button>
                                                <button onClick={() => completeTask(true)} className="flex-[2] bg-green-600 text-white text-4xl font-bold py-6 rounded-2xl shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-3">
                                                    <CheckCircle className="w-10 h-10" />
                                                    ä»»å‹™å®Œæˆ
                                                </button>
                                            </>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}
                
                        {showConfetti && (
                            <div className="fixed inset-0 pointer-events-none z-[60] flex items-center justify-center">
                                <div className="text-7xl md:text-9xl animate-bounce font-black text-yellow-500 drop-shadow-[0_4px_0_rgba(0,0,0,0.2)] bg-white border-8 border-yellow-400 px-12 py-8 rounded-full shadow-2xl">
                                    åŠ åˆ†ï¼ğŸ‰
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            return (
                <div className="relative w-full h-full">
                    {renderContent()}

                    <div 
                        className={`
                            fixed bottom-0 right-0 md:bottom-4 md:right-4 z-[70] 
                            transition-all duration-500 ease-in-out shadow-2xl 
                            rounded-t-2xl md:rounded-2xl overflow-hidden border-4 border-orange-500 bg-white flex flex-col
                            ${isVideoMinimized ? 'w-64 h-14' : 'w-full md:w-[400px] h-auto'}
                        `}
                    >
                        <div 
                            className="bg-orange-500 p-3 flex justify-between items-center cursor-pointer hover:bg-orange-600 transition-colors"
                            onClick={() => setIsVideoMinimized(!isVideoMinimized)}
                            title={isVideoMinimized ? "é»æ“Šå±•é–‹å½±ç‰‡" : "é»æ“Šç¸®å°å½±ç‰‡"}
                        >
                            <div className="flex items-center gap-2 text-white font-bold select-none">
                                <Video className="w-6 h-6" />
                                <span className="text-lg">å¥åº·æ“ä¼´å¥å½±ç‰‡</span>
                            </div>
                            <button 
                                className="text-white bg-orange-700/30 rounded-full p-1 hover:bg-orange-700/50 transition-colors"
                                onClick={(e) => { e.stopPropagation(); setIsVideoMinimized(!isVideoMinimized); }}
                            >
                                {isVideoMinimized ? <Maximize2 size={24} /> : <Minimize2 size={24} />}
                            </button>
                        </div>
                        
                        <div className={`bg-black relative transition-all duration-500 ${isVideoMinimized ? 'h-0 opacity-0' : 'h-64 md:h-60 opacity-100'}`}>
                            <iframe 
                                className="w-full h-full"
                                src="https://www.youtube.com/embed/r34IHFI-29c?enablejsapi=1" 
                                title="YouTube video player" 
                                frameBorder="0" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                                allowFullScreen
                            ></iframe>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ElderMonopoly />);
    </script>
</body>
</html>
